{% extends 'base.html.twig' %}

{% block title %}Genealogy{% endblock %}
{% block monTitre %}
	{% if position == 'enfant' %}
		Ascendance
	{% else %}
		Descendance
	{% endif %}
	de
	{% if user.prenom == false %}
		<span class="small font-italic">Non renseign√©</span>
	{% else %}
		{{ user.prenom|capitalize }}
	{% endif %}
{% endblock %}

{% block body %}

	<div class="container">

		<div class='row-parent-genealogie'>

			{% for parent in parents %}

				<div>
					<div class='cards-genealogie'>

						{% if parent is null %}
							<a href="">Parent inconnu</a>
						{% else %}
							<a href="{{ path('arbre', {id: parent.id, position: 'enfant'}) }}">
								{% if parent.prenom == false %}
									<span class="small font-italic">Non renseign√©</span>
								{% else %}
									{{ parent.prenom|capitalize }}
								{% endif %}
								<br>
								{% if parent.nom == false %}
									<span class="small font-italic">Non renseign√©</span>
								{% else %}
									{{ parent.nom|capitalize }}
								{% endif %}
							</a>
							
							<span type="button" class="badge badge-info d-block" data-toggle="modal" data-target="#exampleModal"  data-user="{{ parent.id }}">üí¨</span>
							<a href="{{ path('usernode_edit', {id: parent.id}) }}"><img style="width:25px; top:20px;" class="badge badge-light d-block" src="{{asset('images/settings.png')}}"></a>
							
						{% endif %}

					</div>

					{# cette condition sert √† ne pas afficher le trait des parents si $user est en position parent et qu'il n'a pas d'enfant #}
					{% if not (position == 'parent' and enfants is null) %}
						<div class='cards-parent-trait'></div>
					{% endif %}

				</div>
			{% endfor %}

		</div>

		{# m√™me id√©e que ligne 32, cette condition sert ici √† ne pas afficher la ligne des enfants si $user est en position parent et qu'il n'a pas d'enfant #}
		{% if not (position == 'parent' and enfants is null) %}

			<div class='trait-relation'></div>

			<div class='row-enfant-genealogie mb-5'>

				{% for enfant in enfants %}
					<div>
						<div class='cards-enfant-trait'></div>
						<div class='cards-genealogie'>

							{% if enfant is null and position == 'enfant' %}
								{# on rentre dans cette condition si on doit g√©n√©rer un arbre avec deux parents inconnus. On a d√©cid√© que pour l'instant il n'y a pas de fratrie possible s'il n'y a pas de parents en BDD #}
								<a href="{{ path('arbre', {id: user.id, position: 'parent'}) }}">
									{% if user.prenom == false %}
										<span class="small font-italic">Non renseign√©</span>
									{% else %}
										{{ user.prenom|capitalize }}
									{% endif %}
									<br>
									{% if user.nom == false %}
										<span class="small font-italic">Non renseign√©</span>
									{% else %}
										{{ user.nom|capitalize }}
									{% endif %}
								</a>
								<span type="button" data-toggle="modal" data-target="#exampleModal" class="badge badge-info d-block" data-user="{{ user.id }}">üí¨</span>
								<a href="{{ path('usernode_edit', {id: user.id}) }}"><img style="width:25px; top:20px;" class="badge badge-light d-block" src="{{asset('images/settings.png')}}"></a>
							{% else %}
								{# affichage de base #}
								<a href="{{ path('arbre', {id: enfant.id, position: 'parent'}) }}">
									{% if enfant.prenom == false %}
										<span class="small font-italic">Non renseign√©</span>
									{% else %}
										{{ enfant.prenom|capitalize }}
									{% endif %}
									<br>
									{% if enfant.nom == false %}
										<span class="small font-italic">Non renseign√©</span>
									{% else %}
										{{ enfant.nom|capitalize }}
									{% endif %}
								</a>
								<span type="button" data-toggle="modal" data-target="#exampleModal" class="badge badge-info d-block" data-user="{{ enfant.id }}">üí¨</span>
								<a href="{{ path('usernode_edit', {id: enfant.id}) }}"><img style="width:25px; top:20px;" class="badge badge-light d-block" src="{{asset('images/settings.png')}}"></a>
							{% endif %}

						</div>
					</div>
				{% endfor %}

			</div>

		{% endif %}

		<div class="btn btn-info mt-5 float-right">
			<a class="text-light" href="{{ path("listeMembres") }}">Retour √† la liste des membres</a>
		</div>

	</div>

	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLongTitle">...</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">...</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	<script>

		$(document).ready(() => {

			$("span[type=button]").click((event) => {

				$id = event.target.getAttribute('data-user');

				$path = "{{ path('user', {id: 'xxx'}) }}";
				$path = $path.replace("xxx", $id);

				$.get($path, function (data, status) {
					$("#exampleModal .modal-title").html(data.prenom + ' ' + data.nom);
					$("#exampleModal .modal-body").html(
						"<b>Date de naissance :</b> " + data.dateNaissance + 
						"<br><b>Ville de naissance :</b> " + data.villeNaissance + 
						"<br><b>Pays de naissance :</b> " + data.paysNaissance + 
						"<br><br><b>Date de d√©c√®s :</b> " + data.dateDeces + 
						"<br><b>Ville de d√©c√®s :</b> " + data.villeDeces + 
						"<br><b>Pays de d√©c√®s :</b> " + data.paysDeces + 
						"<br><br><b>Sexe :</b> " + data.sexe
						);
				});

			});

		});
	</script>
{% endblock %}
