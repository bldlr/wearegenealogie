{% extends 'base.html.twig' %}

{% block title %}Genealogy
{% endblock %}
{% block monTitre %}
	{% if position == 'enfant' %}
		Ascendance
	{% else %}
		Descendance
	{% endif %}
	de
	{{user.prenom|capitalize}}
{% endblock %}

{% block body %}

	<div class="container">

		<div class='row-parent-genealogie'>

			{% for parent in parents %}

				<div>
					<div class='cards-genealogie'>

						{% if parent is null %}
							<a href="">Parent inconnu</a>
						{% else %}
							<a href="{{ path('arbre', {id: parent.id, position: 'enfant'}) }}">
								{{parent.prenom|capitalize}}<br>
								{{parent.nom|capitalize}}
							</a>
							<span type="button" class="badge badge-info d-block" data-toggle="modal" data-target="#exampleModal">💬</span>
						{% endif %}

					</div>

					{# cette condition sert à ne pas afficher le trait des parents si $user est en position parent et qu'il n'a pas d'enfant #}
					{% if not (position == 'parent' and enfants is null) %}
						<div class='cards-parent-trait'></div>
					{% endif %}

				</div>
			{% endfor %}

		</div>

		{# même idée que ligne 32, cette condition sert ici à ne pas afficher la ligne des enfants si $user est en position parent et qu'il n'a pas d'enfant #}
		{% if not (position == 'parent' and enfants is null) %}

			<div class='trait-relation'></div>

			<div class='row-enfant-genealogie mb-5'>

				{% for enfant in enfants %}
					<div>
						<div class='cards-enfant-trait'></div>
						<div class='cards-genealogie'>

							{% if enfant is null and position == 'enfant' %}
								{# on rentre dans cette condition si on doit générer un arbre avec deux parents inconnus. On a décidé que pour l'instant il n'y a pas de fratrie possible s'il n'y a pas de parents en BDD #}
								<a href="{{ path('arbre', {id: user.id, position: 'parent'}) }}">
									{{user.prenom|capitalize}}<br>
									{{user.nom|capitalize}}
								</a>
								<span type="button" data-toggle="modal" data-target="#exampleModal" class="badge badge-info d-block">💬</span>
							{% else %}
								{# affichage de base #}
								<a href="{{ path('arbre', {id: enfant.id, position: 'parent'}) }}">
									{{enfant.prenom|capitalize}}<br>
									{{enfant.nom|capitalize}}
								</a>
								<span type="button" data-toggle="modal" data-target="#exampleModal" class="badge badge-info d-block" data-user="{{ enfant.id }}">💬</span>
							{% endif %}

						</div>
					</div>
				{% endfor %}

			</div>

		{% endif %}

		<div class="btn btn-info mt-5 float-right">
			<a class="text-light" href="{{ path("listeMembres") }}">Retour à la liste des membres</a>
		</div>

	</div>

	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLongTitle">Oups...</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">Rien pour le moment 🤷‍♂️</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	<script>

		console.log("aaa");

		$("span[type=button]").click(() => {

			$.get("{{ path('user', {id: 2}) }}", function (data, status) {
				$("#exampleModal .modal-title").html(data.data);
				console.log(data.data);
			});

		});

	</script>
{% endblock %}
