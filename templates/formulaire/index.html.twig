{% extends 'base.html.twig' %}

{% block title %}
	Formulaire
{% endblock %}

{% block monTitre %}
	Formulaire
{% endblock %}

{% block body %}
	<div class="col-6 mx-auto mb-3">
		{{ form_start(form) }}
		<ul class="users" style="list-style-type: none">
			{% for user in form.users %}
				<div class="border border-primary my-3 p-2">
					<h4>
						{% if user.vars.name == 'personne' %}
						Personne
						{% elseif user.vars.name == 'pere' %}
						Père
						{% elseif user.vars.name == 'mere' %}
						Mère
						{% endif %}
					</h4>
					<p>
						{% for message in app.flashes('error-' ~ user.vars.name) %}
							<div class="alert alert-danger">
								{{message}}
							</div>
						{% endfor %}
					
					</p>
					<!-- il faut faire un form_row pour chaque propriété de l'entité, parce que si on fait un simple form(user), Twig crée une nouvelle balise <form> au sein de la précédente, ce qui fait qu'il n'envoie que le premier des trois formulaires -->
					<li>{{ form_row(user.nom) }}</li>
					<li>{{ form_row(user.prenom) }}</li>
					<li>{{ form_row(user.date) }}</li>
					<li>{{ form_row(user.lieu) }}</li>


						{# PersonData définit l'existance de Personne en BDD en fonction de son champ ID  #}
						{% if user.vars.name == 'personne'%}
							{% set personData = false %}
								{% if not user.vars.data.id is null %}
									{% set personData = true %}
								{% endif %}
						{% endif %}


					{% if user.vars.name != 'pere' and  user.vars.name != 'mere' %}
						<li>{{ form_row(user.sexe) }}</li>
					{% endif %}

					{% if user.vars.name == 'mere' %}
						<!-- Si dans la table Parents Mere == NULL -->
						{% if user.vars.data is empty %}
							<li style="background:red">{{ form_row(user.check, { 'attr': {'checked': 'checked'} }) }}</li>
						{% else %}

							<!-- Mere existe soit par une nouvelle instance soit dans la table User -->
							<!-- Le sexe se génère dans le controlleur lors de l'envoi en BDD -->
							<!-- s'il n'y a pas de sexe alors rien en BDD -->
							{% if user.vars.data.sexe is empty %}
								<!-- Lorsqu'on est dans un forumaire, il existe 2 cas où il n'y a pas de mère en BDD  -->
								<!-- soit lors de la création d'un formulaire soit lorsqu'on créé un parent qui a automatiquement en HTML des parents inconnus et donc sans être en BDD  -->
								<!-- On distingue avec la variable PersonData si dans le formulaire Personne existe-->
								{% if personData %}
									<li style="background:blue">{{ form_row(user.check, { 'attr': {'checked': 'checked'} }) }}</li>
								{% else %}
									<li style="background:yellow">{{ form_row(user.check) }}</li>
								{% endif %}
							{% else %}
							<!-- s'il y a un sexe alors l'instance vient de la BDD -->

								<li style="background:green">{{ form_row(user.check) }}</li>

								
							{% endif %}

						{% endif %}
						

					{% elseif user.vars.name == 'pere' %}
						<!-- Si dans la table Parents Pere == NULL -->
						{% if user.vars.data is empty %}
							<li style="background:red">{{ form_row(user.check, { 'attr': {'checked': 'checked'} }) }}</li>
						{% else %}

							<!-- Pere existe soit par une nouvelle instance soit dans la table User -->
							<!-- Le sexe se génère dans le controlleur lors de l'envoi en BDD -->
							<!-- s'il n'y a pas de sexe alors rien en BDD -->
							{% if user.vars.data.sexe is empty %}
								<!-- Lorsqu'on est dans un forumaire, il existe 2 cas où il n'y a pas de mère en BDD  -->
								<!-- soit lors de la création d'un formulaire soit lorsqu'on créé un parent qui a automatiquement en HTML des parents inconnus et donc sans être en BDD  -->
								<!-- On distingue avec la variable PersonData si dans le formulaire Personne existe-->
								{% if personData %}
									<li style="background:blue">{{ form_row(user.check, { 'attr': {'checked': 'checked'} }) }}</li>
								{% else %}
									<li style="background:yellow">{{ form_row(user.check) }}</li>
								{% endif %}

							{% else %}
								<!-- s'il y a un sexe alors l'instance vient de la BDD -->
								<li style="background:green">{{ form_row(user.check) }}</li>
							{% endif %}

						{% endif %}
					{% endif %}
					{# code couleur :
					- red : parent qui est NULL dans l'instance Parents => CHECKED
					- green : parent qui a un ID dans l'instance Parents => NON CHECKED
					- blue : parent qui n'est ni en tant que pere ou mere dans une instance Parents => CHECKED
					- yellow : parent sans instance lors de la création d'un formulaire => NON CHECKED
					 #}

					
				</div>
			{% endfor %}
			{{ form_row(form.envoyer) }}
		</ul>
		{{ form_end(form) }}
	</div>
{% endblock %}
